(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{744:(e,s,i)=>{"use strict";i.d(s,{y:()=>t});var r=i(926);let t=(0,r.createServerReference)("604d7ee4dd2b90160f39eb8505a9bd409eafd21667",r.callServer,void 0,r.findSourceMapURL,"updateStatus")},5571:(e,s,i)=>{Promise.resolve().then(i.bind(i,8827))},8827:(e,s,i)=>{"use strict";i.d(s,{PriorityBoard:()=>k});var r=i(5155),t=i(2115),n=i(8667),l=i(6467),a=i(3948),d=i(119),c=i(7787),o=i(9027),u=i(7587),m=i(5239),f=i(926);let x=(0,f.createServerReference)("70b2c2eb0a87f08d6d6f8b0f6e14742dcccc99fd2d",f.callServer,void 0,f.findSourceMapURL,"reorder");var p=i(744),h=i(5886),v=i(7812),y=i(7003),g=i(3209);function j(e){var s,i,t,d;let{item:c,types:f,series:x,onComplete:p}=e,{attributes:j,listeners:b,setNodeRef:k,transform:w,transition:N}=(0,o.gl)({id:c.id}),S={transform:u.Ks.Transform.toString(w),transition:N},M=(i=c.availability_end)?(0,n.m)((0,l.H)(i),new Date):null;return(0,r.jsx)("div",{ref:k,style:S,children:(0,r.jsx)(g.Zp,{className:"mb-3 overflow-hidden",children:(0,r.jsx)(g.Wu,{className:"p-0",children:(0,r.jsxs)("div",{className:"flex gap-3 p-3",children:[(0,r.jsx)("div",{...j,...b,className:"w-5 shrink-0 cursor-grab touch-none select-none text-muted-foreground",children:"::"}),c.work.thumbnail_url?(0,r.jsx)(m.default,{src:c.work.thumbnail_url,alt:c.work.title,width:74,height:104,className:"h-[104px] w-[74px] rounded-md object-cover"}):(0,r.jsx)("div",{className:"h-[104px] w-[74px] rounded-md bg-muted"}),(0,r.jsxs)("div",{className:"min-w-0 flex-1 space-y-2",children:[(0,r.jsx)("div",{className:"line-clamp-2 font-medium",children:c.work.title}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(v.E,{variant:"secondary",children:null!=(d=null==(t=f.find(e=>e.id===c.type_id))?void 0:t.name)?d:"不明"}),(null==(s=c.series)?void 0:s.name)?(0,r.jsx)(v.E,{variant:"secondary",children:c.series.name}):null,null!==M&&M<=7?(0,r.jsxs)(v.E,{variant:"danger",children:["期限まで",M,"日"]}):null]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:c.tags.join(" / ")}),c.availability_end?(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["期限: ",(0,a.GP)((0,l.H)(c.availability_end),"yyyy-MM-dd")]}):null,(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(h.O,{item:c,types:f,series:x}),(0,r.jsx)(y.$,{size:"sm",onClick:p,children:"完了"})]})]})]})})})})}function b(e){let{blockKey:s,title:i,children:t}=e,{attributes:n,listeners:l,setNodeRef:a,transform:o}=(0,c.PM)({id:"series-handle:".concat(s.replace("series:",""))}),m=o?{transform:u.Ks.Translate.toString(o)}:void 0;return(0,r.jsxs)(d.P.details,{ref:a,style:m,open:!0,className:"rounded-xl border border-border bg-card/60 p-3",children:[(0,r.jsx)("summary",{...n,...l,className:"mb-3 cursor-grab touch-none select-none text-sm font-semibold",children:i}),t]})}function k(e){let{items:s,types:i,series:n,globalOrder:l,typeOrderMap:a}=e,[u,m]=(0,t.useTransition)(),[f,h]=(0,t.useState)("all"),[v,g]=(0,t.useState)(l),[k,w]=(0,t.useState)(a),N=(0,c.FR)((0,c.MS)(c.AN,{activationConstraint:{distance:6}}),(0,c.MS)(c.IG,{activationConstraint:{delay:140,tolerance:10}})),S=(0,t.useMemo)(()=>{var e;return"all"===f?v:null!=(e=k[f])?e:[]},[f,v,k]),M=(0,t.useMemo)(()=>{let e="all"===f?s:s.filter(e=>e.type_id===f),i=new Map(S.map((e,s)=>[e,s]));return[...e].sort((e,s)=>{var r,t;return(null!=(r=i.get(e.id))?r:999999)-(null!=(t=i.get(s.id))?t:999999)})},[f,s,S]),_=(0,t.useMemo)(()=>new Map(M.map(e=>[e.id,e])),[M]),I=(0,t.useMemo)(()=>{let e=[],s=new Set;for(let r of M){var i;if(null==(i=r.series)?void 0:i.id){if(s.has(r.series.id))continue;s.add(r.series.id);let i=M.filter(e=>{var s;return(null==(s=e.series)?void 0:s.id)===r.series.id}).map(e=>e.id);e.push({key:"series:".concat(r.series.id),kind:"series",seriesName:r.series.name,itemIds:i})}else e.push({key:"single:".concat(r.id),kind:"single",itemIds:[r.id]})}return e},[M]),C=(0,t.useMemo)(()=>{let e=new Map;for(let s of I)for(let i of s.itemIds)e.set(i,s.key);return e},[I]),E=e=>{if("all"===f){g(e),m(async()=>{await x("global",null,e)});return}w(s=>({...s,[f]:e})),m(async()=>{await x("type",f,e)})},O=e=>{m(async()=>{await (0,p.y)(e,"completed")})};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(y.$,{size:"sm",variant:"all"===f?"default":"secondary",onClick:()=>h("all"),children:"すべて"}),i.map(e=>(0,r.jsx)(y.$,{size:"sm",variant:f===e.id?"default":"secondary",onClick:()=>h(e.id),children:e.name},e.id))]}),(0,r.jsx)(c.Mp,{sensors:N,collisionDetection:c.fp,onDragEnd:e=>{let{active:s,over:i}=e;if(!i||s.id===i.id)return;let r=String(s.id),t=String(i.id),n=r.startsWith("series-handle:")?"series:".concat(r.replace("series-handle:","")):C.get(r),l=C.get(t);if(!n||!l)return;if(n===l){let e=I.find(e=>e.key===n);if(!e||"series"!==e.kind)return;let s=e.itemIds.indexOf(r),i=e.itemIds.indexOf(t);if(s<0||i<0||s===i)return;let l=(0,o.be)(e.itemIds,s,i),a=new Set(e.itemIds),d=[];S.forEach((e,s)=>{a.has(e)&&d.push(s)});let c=[...S];d.forEach((e,s)=>{c[e]=l[s]}),E(c);return}let a=I.map(e=>e.key),d=a.indexOf(n),c=a.indexOf(l);if(d<0||c<0)return;let u=(0,o.be)(a,d,c),m=new Map(I.map(e=>[e.key,e])),f=[];for(let e of u){let s=m.get(e);s&&f.push(...s.itemIds)}E(f)},children:(0,r.jsx)(o.gB,{items:M.map(e=>e.id),strategy:o._G,children:I.map((e,s)=>{if("series"===e.kind)return(0,r.jsx)(b,{blockKey:e.key,title:(0,r.jsx)(d.P.span,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:.05*s},className:"inline-block",children:e.seriesName}),children:e.itemIds.map(e=>{let s=_.get(e);return s?(0,r.jsx)(j,{item:s,types:i,series:n,onComplete:()=>O(e)},e):null})},e.key);let t=e.itemIds[0],l=_.get(t);return l?(0,r.jsx)(j,{item:l,types:i,series:n,onComplete:()=>O(t)},t):null})})}),u?(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:"保存中..."}):null]})}}},e=>{e.O(0,[707,562,174,661,169,431,441,255,358],()=>e(e.s=5571)),_N_E=e.O()}]);